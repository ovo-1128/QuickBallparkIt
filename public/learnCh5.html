<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‹ç®—å„ªå…ˆé †åºå­¸ç¿’</title>
    <style>
body {
    font-family: Arial, sans-serif;
    background-color: #f9f9f9;
    text-align: center;
    margin: 0;
    padding: 0;
}
.banner {
    background-color: #4CAF50;
    color: white;
    padding: 15px;
    font-size: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}
.banner a {
    position: absolute;
    left: 15px;
}
.banner h1, .banner span {
    flex-grow: 1;
    text-align: center;
    margin: 0;
}
.content {
    max-width: 700px;
    margin: 20px auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}
.dialog-box {
    border: 1px solid #ddd;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 8px;
    background-color: #fff;
    text-align: left;
    position: relative;
    transition: all 0.3s ease;
}
.dialog-box.highlight-hint {
    background-color: #ffffe0;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
}
.helper-image {
    width: 50px;
    height: 50px;
    position: absolute;
    top: 10px;
    left: 10px;
    border-radius: 50%;
}
.dialog-text {
    margin-left: 70px;
    line-height: 1.5;
    font-size: 16px;
    color: #333;
}
.step-container, .dropzone {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
}
.step {
    font-size: 18px;
    padding: 10px;
    background-color: white;
    cursor: grab;
    border: 2px solid #ddd;
    border-radius: 5px;
    display: inline-block;
}
.dropzone {
    min-height: 60px;
    padding: 10px;
    border: 2px dashed #888;
    background-color: #f0f0f0;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}
.incorrect {
    background-color: #ffdddd;
    border-color: red;
}
button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 8px 16px;
    cursor: pointer;
    margin: 5px;
    font-size: 16px;
    border-radius: 4px;
    font-weight: bold;
}
button:hover {
    background-color: #45a049;
}
button:disabled {
    background-color: #d3d3d3;
    color: #888;
    cursor: not-allowed;
}
.highlight {
    color: red;
    font-weight: bold;
}
    </style>
</head>
<body onload="generateQuestion()">
<div class="banner">
    <a href="homepage.html"><button>å›ä¸»é é¢</button></a>
    <span>æ‹¬è™Ÿé‹ç®—é †åºå­¸ç¿’</span>
</div>
<div class="content">
    <div class="dialog-box" id="dialog-box">
        <img src="pic/helper.jpg" alt="å°è€å¸«" class="helper-image">
        <div class="dialog-text" id="dialogText">ä¸ç¢ºå®šçš„è©±å¯ä»¥é»æ“Šæç¤ºæŒ‰éˆ•ç²å¾—æç¤ºå–”ï¼</div>
    </div>
    <h4>ğŸ” è©¦è‘—æ’åºé€™äº›æ­¥é©Ÿ</h4>
    <p>æŒ‰ç…§è¦å‰‡ï¼š<span class="highlight">å…ˆç®—æ‹¬è™Ÿå…§çš„æ•¸å­—</span> â†’ <span class="highlight">å†ä¹˜é™¤</span> â†’ <span class="highlight">æœ€å¾ŒåŠ æ¸›</span></p>
    <h3><p class="equation" id="equation">è¨ˆç®—ä¸­...</p></h3>
    <div class="step-container" id="step-container"></div>
    <h3>ğŸ‘‰ æ‹–æ›³æ­£ç¢ºé †åºåˆ°é€™è£¡ (ä¾ç…§ç¬¬ä¸€æ­¥ã€ç¬¬äºŒæ­¥ã€ç­”æ¡ˆçš„é †åº)</h3>
    <div class="dropzone" id="dropzone" ondragover="allowDrop(event)" ondrop="drop(event)"></div>

    <button onclick="checkOrder()">æª¢æŸ¥ç­”æ¡ˆ</button>
    <button id="next-btn" onclick="generateQuestion()" disabled>ä¸‹ä¸€é¡Œ</button>
    <button onclick="resetOrder()">é‡è¨­</button>
    <button onclick="showHint()">æç¤º</button>

    <div id="result"></div>

    <audio id="hintSound" src="pic/hintSound.mp3"></audio>

    <script>
        let correctOrder = [];

        function allowDrop(event) { event.preventDefault(); }
        function drag(event) { event.dataTransfer.setData("text", event.target.id); }
        function drop(event) {
            event.preventDefault();
            let data = event.dataTransfer.getData("text");
            let element = document.getElementById(data);
            if (element && !event.currentTarget.contains(element)) {
                event.currentTarget.appendChild(element);
            }
        }

        function checkOrder() {
            let userSteps = Array.from(document.getElementById("dropzone").children);
            let incorrectSteps = [];

            if (userSteps.length !== correctOrder.length) {
                document.getElementById("result").innerText = "âŒ è«‹æ”¾å…¥æ‰€æœ‰æ­¥é©Ÿï¼";
                return;
            }

            userSteps.forEach((step, index) => {
                if (parseInt(step.dataset.stepIndex) !== index) {
                    step.classList.add("incorrect");
                    incorrectSteps.push(index + 1);
                } else {
                    step.classList.remove("incorrect");
                }
            });

            if (incorrectSteps.length === 0) {
                document.getElementById("result").innerText = "ğŸ‰ å®Œå…¨æ­£ç¢ºï¼";
                document.getElementById("next-btn").disabled = false;
            } else {
                document.getElementById("result").innerText = `âš ï¸ ç¬¬ ${incorrectSteps.join(", ")} æ­¥æœ‰èª¤ï¼Œè«‹å†æª¢æŸ¥ï¼`;
            }
        }

        function generateQuestion() {
            resetOrder();
            let a, b, c, result1, result2;
            const operators = ['+', '-', 'Ã—', 'Ã·'];
            let valid = false;

            while (!valid) {
                a = Math.floor(Math.random() * 9) + 2;
                b = Math.floor(Math.random() * 9) + 2;
                c = Math.floor(Math.random() * 9) + 2;
                let op1 = operators[Math.floor(Math.random() * 4)];
                let op2 = operators[Math.floor(Math.random() * 4)];

                if (op1 === 'Ã·' && a % b !== 0) continue;
                result1 = eval(`${a} ${op1 === 'Ã—' ? '*' : op1 === 'Ã·' ? '/' : op1} ${b}`);
                if (!Number.isInteger(result1) || result1 < 0) continue;

                if (op2 === 'Ã·' && result1 % c !== 0) continue;
                result2 = eval(`${result1} ${op2 === 'Ã—' ? '*' : op2 === 'Ã·' ? '/' : op2} ${c}`);
                if (!Number.isInteger(result2) || result2 < 0) continue;

                valid = true;

                correctOrder = [
                    `(${a} ${op1} ${b}) â†’ ${result1}`,
                    `${result1} ${op2} ${c} â†’ ${result2}`,
                    `ç­”æ¡ˆï¼š${result2}`
                ];

                document.getElementById("equation").innerText = `(${a} ${op1} ${b}) ${op2} ${c}`;

                const shuffledSteps = [...correctOrder].sort(() => Math.random() - 0.5);
                document.getElementById("step-container").innerHTML = shuffledSteps.map((step, i) =>
                    `<div class='step' draggable='true' ondragstart='drag(event)' id='step-${i}' data-step-index='${correctOrder.indexOf(step)}'>${step}</div>`
                ).join('');

                document.getElementById("next-btn").disabled = true;
                document.getElementById("result").innerText = "";
                document.getElementById("dialogText").innerText = "ä¸ç¢ºå®šçš„è©±å¯ä»¥é»æ“Šæç¤ºæŒ‰éˆ•ç²å¾—æç¤ºå–”ï¼";
                document.getElementById("dialog-box").classList.remove("highlight-hint");
            }
        }

        function resetOrder() {
            const dropzone = document.getElementById("dropzone");
            const stepContainer = document.getElementById("step-container");
            while (dropzone.firstChild) {
                stepContainer.appendChild(dropzone.firstChild);
            }
            Array.from(stepContainer.children).forEach(el => el.classList.remove("incorrect"));
            document.getElementById("result").innerText = "";
            document.getElementById("next-btn").disabled = true;
            document.getElementById("dialogText").innerText = "ä¸ç¢ºå®šçš„è©±å¯ä»¥é»æ“Šæç¤ºæŒ‰éˆ•ç²å¾—æç¤ºå–”ï¼";
            document.getElementById("dialog-box").classList.remove("highlight-hint");
        }

        function showHint() {
            let userSteps = Array.from(document.getElementById("dropzone").children);
            let hintMessage = "";

            if (userSteps.length === 0) {
                hintMessage = "è«‹å…ˆå°‡æ‰€æœ‰æ­¥é©Ÿæ”¾å…¥æ¡†å…§ï¼";
            } else {
                let incorrectSteps = [];

                userSteps.forEach((step, index) => {
                    let stepIndex = parseInt(step.dataset.stepIndex);
                    if (stepIndex !== index) {
                        incorrectSteps.push(index + 1);
                    }
                });

                if (incorrectSteps.length === 0) {
                    hintMessage = "ğŸ‰ ä½ çš„é †åºå¹¾ä¹æ­£ç¢ºï¼å†ç¢ºèªä¸€ä¸‹æ‰€æœ‰æ­¥é©Ÿæ˜¯å¦é½Šå…¨ï¼";
                } else {
                    hintMessage += `âš ï¸ é€™äº›æ­¥é©Ÿçš„é †åºå¯èƒ½æœ‰èª¤ï¼š${incorrectSteps.join(", ")}ã€‚\n`;
                    hintMessage += "ğŸ‘‰ æç¤ºï¼šå…ˆç®—æ‹¬è™Ÿï¼Œå†ä¹˜é™¤ï¼Œæœ€å¾ŒåŠ æ¸›ï¼";
                }
            }

            document.getElementById("dialogText").innerText = hintMessage;

            // æ’­æ”¾æç¤ºéŸ³æ•ˆ
            document.getElementById("hintSound").play();

            // å‹•ç•«æ•ˆæœé–ƒçˆæç¤ºæ¡†
            const dialogBox = document.getElementById("dialog-box");
            dialogBox.classList.add("highlight-hint");
            setTimeout(() => dialogBox.classList.remove("highlight-hint"), 1000);
        }

    </script>
</div>
</body>
</html>
